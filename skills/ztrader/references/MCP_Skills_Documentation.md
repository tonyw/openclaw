# ZTrader MCP 服务 Skills 文档

## 概述

本 MCP 服务为 OpenClaw 提供A股主板股票技术分析和选股能力。核心功能包括：

1. **Pipeline 选股漏斗**：基于具体某个交易日所有A股所有主板股票收盘价，多阶段量化选股入池。
2. **AI 预测评分**：基于具体某个交易日Pipeline 选股漏斗的最终结果，给出次日选股建议。
3. **A股主板股票信息**：股票信息，技术指标，开盘啦题材，东财行业与题材（概念/行业/地域板块及成分）。

---

## 一、Pipeline 选股漏斗工具 (`get_pipeline_results`)

### 1.1 工具说明

`get_pipeline_results` 用于获取 Pipeline 选股流程中**某个阶段**的股票列表。Pipeline 是一个多阶段的量化选股漏斗，基于具体某个交易日所有A股主板股票收盘价，通过层层筛选，最终得到符合技术形态要求的股票池。

**重要说明**：Pipeline 选股漏斗是 AI 预测评分的**输入来源**。AI 预测评分主要针对 Pipeline 选股漏斗最终结果（`ddy_filtered` 阶段）中的股票进行详细分析。

### 1.2 Pipeline 选股阶段说明

Pipeline 选股流程包含以下阶段（按执行顺序）：

#### 阶段 1：初始筛选阶段

- **`kdj_b1`**：KDJ B1 选股
  - 基于 KDJ 指标的 B1 形态筛选
- **`needle_below30`**：单针下 30 选股
  - 长期 > 80 且短期 < 30 的形态
- **`yidong`**：异动选股
  - 识别股价异动信号
- **`lianban`**：连板选股
  - 识别连续涨停板股票

#### 阶段 2：合并分析

- **`merged`**：合并分析（阶段 1：倍量柱且无 3 连板）
  - 合并上述初始筛选结果
  - 筛选条件：倍量柱且无 3 连板

#### 阶段 3：交易量筛选

- **`filtered`**：交易量筛选（阶段 2）
  - 基于交易量指标进一步筛选

#### 阶段 4：大单筛选

- **`ddx_filtered`**：DDX 筛选（阶段 3：大单无背离）
  - 基于 DDX（大单动向）指标筛选
  - 确保大单无背离信号

#### 阶段 5：高点筛选

- **`ddy_filtered`**：DDY 筛选（阶段 4：高点无砸盘）
  - 基于 DDY（涨跌动因）指标筛选
  - 确保高点无砸盘信号

#### 阶段 6：题材分析

- **`kpl_analyzed`**：KPL 题材分析
  - 基于开盘啦题材库进行题材面分析，KPL（开盘啦）数据只作为AI分析时候的辅助信息，并不用于筛选股票。

### 1.3 漏斗逻辑

Pipeline 选股是一个**漏斗式筛选**过程：

- 每个阶段都会过滤掉不符合条件的股票
- 越往后的阶段，股票数量越少，质量越高
- 最终 `ddy_filtered` 阶段的股票是经过多轮筛选的优质标的，这些股票将作为 AI 预测评分的输入

**典型漏斗数据示例**：

- `kdj_b1`: 400+ 只股票
- `merged`: 100+ 只股票
- `filtered`: 80+ 只股票
- `ddx_filtered`: 40+ 只股票
- `ddy_filtered`: 30+ 只股票（这些股票将进入 AI 预测评分流程）

### 1.4 何时调用 `get_pipeline_results`

#### ✅ 应该调用的场景：

1. **用户询问今日/某日的选股结果**
   - 例如："今天有哪些股票通过了筛选？"
   - 例如："查看 2026-01-30 的选股结果"
   - 例如："最新的 Pipeline 选股结果是什么？"

2. **用户询问某个阶段的股票列表**
   - 例如："DDX 筛选阶段有哪些股票？"
   - 例如："查看 KDJ B1 选股的结果"
   - 例如："最终筛选（ddy_filtered）阶段有多少只股票？"

3. **用户需要了解选股漏斗的各个阶段数据**
   - 例如："各个阶段的股票数量是多少？"
   - 例如："选股漏斗的通过率如何？"
   - 注意：需要多次调用不同阶段，或使用 `/api/pipeline/funnel` 接口

4. **用户需要批量查看符合条件的股票**
   - 例如："给我推荐一些符合技术形态的股票"
   - 例如："有哪些股票通过了所有筛选？"

5. **用户询问某个阶段的具体筛选逻辑**
   - 例如："为什么这只股票在 merged 阶段被筛选掉了？"
   - 注意：需要查看该股票在前后阶段的入选情况

#### ❌ 不应该调用的场景：

1. **用户询问单只股票的详细分析**
   - 应该使用 `get_ai_predict` 获取该股票的 AI 评分和详细分析
   - `get_pipeline_results` 只返回股票列表，不包含详细评分
   - **注意**：通常先通过 `get_pipeline_results` 获取股票列表，再对感兴趣的股票调用 `get_ai_predict`

2. **用户询问股票的基础信息**
   - 应该使用 `get_stock_basic` 或 `search_stocks`

3. **用户询问股票的技术指标**
   - 应该使用 `get_stock_technical`、`get_stock_kline` 等工具

### 1.5 调用示例

```json
{
  "name": "get_pipeline_results",
  "parameters": {
    "stage": "ddy_filtered", // 必填，阶段名称
    "trade_date": "2026-01-30", // 可选，不传则返回最新日期
    "limit": 50 // 可选，返回数量，默认 50
  }
}
```

### 1.6 可用阶段列表

- `kdj_b1`: KDJ B1 选股
- `needle_below30`: 单针下 30 选股
- `yidong`: 异动选股
- `lianban`: 连板选股
- `merged`: 合并分析（阶段 1）
- `filtered`: 交易量筛选（阶段 2）
- `ddx_filtered`: DDX 筛选（阶段 3）
- `ddy_filtered`: DDY 筛选（阶段 4，**最终筛选结果，将进入 AI 预测评分**）
- `kpl_analyzed`: KPL 题材分析

### 1.7 返回字段说明

- `ts_code`: 股票代码
- `stock_name`: 股票名称
- `trade_date`: 交易日期
- `reason`: 入选理由（部分阶段有）

---

## 二、AI 预测评分工具 (`get_ai_predict` 与 `get_ai_predict_by_date`)

### 2.1 工具说明

`get_ai_predict` 用于获取单只股票的 AI 技术形态评分结果。该评分基于严格的技术形态分析标准，适用于**短线交易（持有周期 1-5 个交易日）**的股票筛选。

**重要说明**：AI 预测评分主要针对 Pipeline 选股漏斗最终结果（`ddy_filtered` 阶段）中的股票进行详细分析。虽然也可以对任意股票进行评分，但**建议优先关注 Pipeline 选股结果中的股票**。

### 2.2 评分体系

评分采用综合打分制：**总分 S = 基础形态分 + 加分项 - 惩罚项 + 开盘啦题材面分析**

#### 基础形态分（0-100 分）

- **低位放量吸筹**（0-20 分）：识别主力在底部建仓信号
- **最后一个交易日K线缩量且低波动**（0-20 分）：判断是否处于震荡结尾阶段
- **N型上涨结构**（0-10 分）：确认股价处于上升趋势中
- **前期无连续跳空涨停**（0-20 分）：避免追高冲刺后的股票
- **量能结构**（0-10 分）：上涨阶段成交量大于下跌阶段
- **无阶梯两出货**（0-10 分）：排除高位出货信号
- **无绿帽子**（0-5 分）：排除顶部放量下跌
- **不是蜈蚣图**（0-5 分）：判断主力资金实力

#### 加分项（0-10 分）

- **收盘强度**（0-5 分）：收盘价在当日振幅中的位置
- **低位反包**（0-5 分）：低位放量收复前日阴线

#### 惩罚项（扣分）

- **放量阴线惩罚**：20 个交易日内出现放量阴线，根据是否收复及成交量情况扣 5-15 分
- **A杀惩罚**：90 个交易日内出现 A 杀形态，扣 20-30 分

#### 开盘啦题材面分析（-5 到 +15 分）

- 基于开盘啦专业打板 app 的题材库数据
- 题材活跃度、历史爆发力、是否属于新质生产力等

### 2.3 最终结论阈值

- **S ≥ 85**：技术形态上具备交易价值
- **65 ≤ S ≤ 84**：观望
- **S < 64**：技术形态上不具备交易价值，或者交易风险较高

### 2.4 何时调用 `get_ai_predict`

#### ✅ 应该调用的场景：

1. **从 Pipeline 选股结果中挑选优质股票**（**推荐场景**）
   - 先调用 `get_pipeline_results(stage="ddy_filtered")` 获取最终筛选的股票列表
   - 对列表中的股票调用 `get_ai_predict` 获取详细评分
   - 根据评分（S≥85 具备交易价值）决定是否买入

2. **用户询问单只股票的投资建议**
   - 例如："600855.SH 这只股票怎么样？"
   - 例如："帮我分析一下 000001.SZ 是否值得买入？"
   - 例如："002427.SZ 现在适合买入吗？"

3. **用户需要了解股票的 AI 评分**
   - 例如："这只股票的 AI 评分是多少？"
   - 例如："查看 600855.SH 的最新 AI 预测结果"

4. **用户询问股票的买入/卖出时机**
   - 例如："什么时候买入 000001.SZ 比较合适？"
   - 注意：需要结合 AI 评分和技术指标综合判断

5. **用户需要了解股票的详细分析原因**
   - 例如："为什么这只股票评分是 85 分？"
   - 例如："这只股票的形态要点是什么？"

#### ❌ 不应该调用的场景：

1. **用户询问股票列表或批量股票**
   - 应该先使用 `get_pipeline_results` 获取选股结果列表
   - `get_ai_predict` 一次只能查询单只股票

2. **用户询问历史评分趋势**
   - 虽然可以指定 `trade_date` 参数，但主要用于查看特定日期的评分
   - 如需查看多日评分，需要多次调用

3. **用户询问股票的基础信息（代码、名称、行业等）**
   - 应该使用 `get_stock_basic` 或 `search_stocks`

### 2.5 调用示例

```json
{
  "name": "get_ai_predict",
  "parameters": {
    "code": "600855.SH",
    "trade_date": "2026-01-30" // 可选，不传则返回最新日期
  }
}
```

**注意**：`code` 参数中的股票代码通常来自 `get_pipeline_results` 的返回结果。

### 2.6 返回字段说明

- `ts_code`: 股票代码
- `stock_name`: 股票名称
- `trade_date`: 预测日期
- `score`: AI 评分（0-100，越高越好）
- `rank`: 当天排名（按 score 降序，1 为最高分）
- `pipeline_version`: Pipeline 版本
- `stage_version`: 阶段版本

### 2.7 按日期获取全天 AI 预测 (`get_ai_predict_by_date`)

#### 工具说明

`get_ai_predict_by_date` 用于获取**某一天的全部 AI 预测结果**，无需指定股票代码。返回该日所有参与评分的股票列表，按排名升序排列，便于分析当日整体选股情况（如高分股票数量、分数分布等）。

与 `get_ai_predict` 的区别：

- `get_ai_predict`：单只股票、需传 `code`，用于查看某只股票的评分。
- `get_ai_predict_by_date`：按日期查全天结果、不需 `code`，用于分析某一天的整体选股情况。

#### 何时调用 `get_ai_predict_by_date`

##### ✅ 应该调用的场景：

1. **用户询问某一天的整体选股/评分情况**
   - 例如："2026-01-30 那天有哪些股票被 AI 推荐？"
   - 例如："看一下上周五的选股排名"
   - 例如："某天有多少只股票评分在 85 分以上？"

2. **用户需要按日期对比或复盘**
   - 例如："对比一下这三天的高分股有什么变化"
   - 例如："某天的选股名单导出来看看"

3. **用户不关心单只股票，只关心当日全貌**
   - 例如："那天整体选股情况怎么样？"

##### ❌ 不应该调用的场景：

1. **用户只问单只股票的评分**
   - 应使用 `get_ai_predict(code="xxx")`，更直接

2. **用户问的是 Pipeline 某阶段的股票列表（未做 AI 评分前的入池名单）**
   - 应使用 `get_pipeline_results`

#### 调用示例

```json
{
  "name": "get_ai_predict_by_date",
  "parameters": {
    "trade_date": "2026-01-30",
    "pipeline_version": "v1.0",
    "limit": 200
  }
}
```

- `trade_date`：必填，交易日期，格式 `YYYY-MM-DD`。
- `pipeline_version`：可选，默认 `v1.0`。
- `limit`：可选，返回条数（按排名取前 N 条），默认 200。

#### 返回说明

返回**列表**，每条与 `get_ai_predict` 单条结构一致，按 `rank` 升序：

- `ts_code`: 股票代码
- `stock_name`: 股票名称
- `trade_date`: 预测日期
- `score`: AI 评分（0-100）
- `rank`: 当天排名（1 为最高分）
- `pipeline_version`: Pipeline 版本
- `stage_version`: 阶段版本

---

## 三、Pipeline 选股与 AI 预测的关系

### 3.1 工作流程关系

**Pipeline 选股是 AI 预测评分的输入来源**：

1. **Pipeline 选股**（第一步）：基于具体某个交易日所有A股主板股票收盘价，通过多阶段量化筛选，得到符合技术形态的股票池（最终结果在 `ddy_filtered` 阶段）
2. **AI 预测评分**（第二步）：对 Pipeline 筛选出的股票（主要是 `ddy_filtered` 阶段的股票）进行详细的技术形态分析，给出 0-100 的评分，提供次日选股建议

**数据流向**：

```
所有A股主板股票 → Pipeline选股漏斗 → ddy_filtered阶段股票列表 → AI预测评分 → 买入建议（S≥85）
```

### 3.2 典型使用场景

#### 场景 1：从 Pipeline 结果中挑选优质股票（**推荐流程**）

```
1. 调用 get_pipeline_results(stage="ddy_filtered") 获取最终筛选的股票列表
2. 对列表中的股票，调用 get_ai_predict(code="xxx") 获取详细评分
3. 根据评分（S≥85 具备交易价值）决定是否买入
```

#### 场景 2：查看今日选股结果并分析（**推荐流程**）

```
1. 调用 get_pipeline_results(stage="ddy_filtered") 获取今日最终筛选结果
2. 对列表中的股票，可以批量调用 get_ai_predict 获取评分
3. 按评分排序，优先关注高分股票（S≥85）
```

#### 场景 3：分析单只股票的买入时机

```
1. 用户询问："600855.SH 现在适合买入吗？"
2. 调用 get_ai_predict(code="600855.SH") 获取评分和详细分析
3. 结合评分阈值（S≥85 具备交易价值）给出建议
4. 如需更多技术细节，可调用 get_stock_technical、get_stock_kline 等
```

#### 场景 4：分析某一天的整体选股情况

```
1. 用户询问："2026-01-30 那天整体选股情况怎么样？" 或 "那天有多少只高分股？"
2. 调用 get_ai_predict_by_date(trade_date="2026-01-30") 获取该日全部 AI 预测结果（按排名排序）
3. 可统计 S≥85 的数量、列出前 N 名、或做分数分布分析
```

### 3.3 数据一致性

- Pipeline 选股结果和 AI 预测结果都基于**相同的交易日期**
- 建议使用相同的 `trade_date` 参数，确保数据一致性
- 如果不指定 `trade_date`，两者都会返回最新日期的数据

---

## 四、其他相关工具

### 4.1 股票基础信息工具

- **`search_stocks`**：搜索股票（支持代码或名称模糊搜索）
- **`get_stock_basic`**：获取股票基础信息（代码、名称、行业、市场等）

### 4.2 技术指标工具

- **`get_stock_kline`**：获取 K 线数据（开高低收、成交量等）
- **`get_stock_technical`**：获取技术指标（MACD、KDJ、RSI、布林带、均线等）
- **`get_stock_white_yellow`**：获取黄白线指标（短期/长期趋势线），白线为短期趋势线，使用通达信公式 EMA(EMA(C,10),10)，黄线为长期趋势线，使用通达信公式 (MA(CLOSE,14)+MA(CLOSE,28)+MA(CLOSE,57)+MA(CLOSE,114))/4。黄白线是选股逻辑中的重要参考。

### 4.3 资金流向工具

- **`get_ddx_ddy`**：获取 DDX/DDY 大单动向指标
- **`get_stock_money_flow`**：获取资金流向数据（主力、超大单、大单等）

### 4.4 题材概念工具

- **`get_kpl_concepts`**：获取股票所属的 KPL（开盘啦）概念/题材，数据来自本地 `kpl_concept_cons` 表，与交易日强相关，通常返回该股当日关联的若干题材（如关注度最高的前几条）。
- **`get_concept_stocks`**：获取某个 KPL 概念（题材）下的所有成分股，按日期查询，数据来自 `kpl_concept_cons` 表。

详见 [五、开盘啦（KPL）数据说明](#五开盘啦kpl数据说明)。

- **`get_dc_indices`**：获取东财（东方财富）概念/行业/地域板块列表（dc_index / dc_daily），支持按日期、板块类型、关键词筛选。
- **`get_dc_members`**：获取指定东财板块（ts_code 如 BK1184.DC）的成分股列表（dc_member）。

详见 [六、东财（DC）行业与题材数据说明](#六东财dc行业与题材数据说明)。

### 4.5 市场指数工具

- **`get_index_daily`**：获取大盘指数日线行情（上证、深证、创业板等）

---

## 五、开盘啦（KPL）数据说明

开盘啦（KPL）是专业打板 app，本服务使用的题材数据来自 Tushare，仅用于量化研究与选股辅助分析。

### 5.1 数据来源

| 用途       | Tushare 接口       | 说明                                                                                                                                                       |
| ---------- | ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 题材库     | `kpl_concept`      | 每日盘后更新，单次最大 5000 条，可按日期循环获取。                                                                                                         |
| 题材成分股 | `kpl_concept_cons` | 获取某题材下的成分股，单次最大 3000 条。参考 [Tushare 开盘啦题材成分](https://tushare.pro/document/2?doc_id=351)。**注意**：该接口因源站改版暂无新增数据。 |
| 榜单       | `kpl_list`         | 涨停/炸板/跌停等榜单。参考 [Tushare 开盘啦榜单数据](https://tushare.pro/document/2?doc_id=347)。本服务当前未接入。                                         |

本地仅使用题材库（`kpl_concept`）与题材成分（`kpl_concept_cons`）两张表。

### 5.2 本地表结构与字段

- **题材库表 `kpl_concept`**（对应 Tushare `kpl_concept` 返回）

  | 字段       | 类型    | 说明                  |
  | ---------- | ------- | --------------------- |
  | trade_date | String  | 交易日期 YYYYMMDD     |
  | ts_code    | String  | 题材代码（xxxxxx.KP） |
  | name       | String  | 题材名称              |
  | z_t_num    | Integer | 涨停数量              |
  | up_num     | Integer | 排名上升位数          |

- **题材成分表 `kpl_concept_cons`**（对应 Tushare `kpl_concept_cons` 返回）

  | 字段       | 类型    | 说明                                 |
  | ---------- | ------- | ------------------------------------ |
  | ts_code    | String  | 题材 ID（xxxxxx.KP）                 |
  | name       | String  | 题材名称                             |
  | con_name   | String  | 股票名称                             |
  | con_code   | String  | 股票代码（如 xxxxxx.SH / xxxxxx.SZ） |
  | trade_date | String  | 交易日期                             |
  | desc       | Text    | 描述                                 |
  | hot_num    | Integer | 人气值                               |

工具 `get_kpl_concepts`、`get_concept_stocks` 的查询均基于上述 `kpl_concept_cons`（及题材名称等）实现。

### 5.3 注意事项

1. **题材成分接口**：Tushare 的 `kpl_concept_cons` 因源站改版暂无新增数据，历史数据仍可用，新日期可能无更新。
2. **与交易日强相关**：题材、成分均按日维护，使用工具时须指定或约定 `trade_date`。
3. **仅作辅助**：题材信息不参与 Pipeline 筛选，只作为 AI 分析时的参考；无法保证股票与题材的相关度，新型题材或消息杂乱时需谨慎。

---

## 六、东财（DC）行业与题材数据说明

东财（东方财富）概念/行业/地域板块数据来自 Tushare，用于行业与题材分析、板块成分与行情查询。

### 6.1 数据来源

| 用途         | Tushare 接口 | 说明                                                                                                                                                                         |
| ------------ | ------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 概念板块列表 | `dc_index`   | 每个交易日的概念板块（名称、领涨股、涨跌幅、上涨家数等）。参考 [Tushare 东方财富概念板块](https://tushare.pro/document/2?doc_id=362)。单次最大 5000 条。                     |
| 板块成分股   | `dc_member`  | 按板块代码与交易日期获取成分股。参考 [Tushare 东方财富板块成分](https://tushare.pro/document/2?doc_id=363)。单次最大 5000 条。                                               |
| 板块行情     | `dc_daily`   | 东财概念/行业/地域板块日行情（开高低收、涨跌幅、换手率等）。参考 [Tushare 东财概念板块行情](https://tushare.pro/document/2?doc_id=382)。历史自 2020 年起，单次最大 2000 条。 |

本地表：`dc_index`（概念板块）、`dc_member`（板块成分）、`dc_daily`（板块日行情）。

### 6.2 本地表结构与字段

- **概念板块表 `dc_index`**（对应 Tushare `dc_index`）

  | 字段          | 类型    | 说明                     |
  | ------------- | ------- | ------------------------ |
  | ts_code       | String  | 概念代码（如 BK1184.DC） |
  | trade_date    | String  | 交易日期 YYYYMMDD        |
  | name          | String  | 概念名称                 |
  | leading       | String  | 领涨股票名称             |
  | leading_code  | String  | 领涨股票代码             |
  | pct_change    | Float   | 涨跌幅                   |
  | leading_pct   | Float   | 领涨股票涨跌幅           |
  | total_mv      | Float   | 总市值（万元）           |
  | turnover_rate | Float   | 换手率                   |
  | up_num        | Integer | 上涨家数                 |
  | down_num      | Integer | 下降家数                 |

- **板块成分表 `dc_member`**（对应 Tushare `dc_member`）

  | 字段       | 类型   | 说明                     |
  | ---------- | ------ | ------------------------ |
  | trade_date | String | 交易日期 YYYYMMDD        |
  | ts_code    | String | 板块代码（如 BK1184.DC） |
  | con_code   | String | 成分股票代码             |
  | name       | String | 成分股名称               |

- **板块行情表 `dc_daily`**（对应 Tushare `dc_daily`）

  | 字段                      | 类型   | 说明                    |
  | ------------------------- | ------ | ----------------------- |
  | ts_code                   | String | 板块代码（xxxxx.DC）    |
  | trade_date                | String | 交易日期 YYYYMMDD       |
  | close / open / high / low | Float  | 收盘/开盘/最高/最低点位 |
  | pct_change                | Float  | 涨跌幅                  |
  | turnover_rate             | Float  | 换手率                  |
  | vol / amount              | Float  | 成交量(股)/成交额(元)   |

### 6.3 相关 MCP 工具

- **`get_dc_indices`**：获取东财概念/行业/地域板块列表。概念板块来自 `dc_index`（含名称、领涨股、涨跌幅）；行业/地域来自 `dc_daily`（当前仅行情，名称显示为代码）。支持按日期、类型、关键词筛选。
- **`get_dc_members`**：获取指定东财板块（ts_code，如 BK1184.DC）的成分股列表，可按交易日期查询。

### 6.4 注意事项

1. **与交易日强相关**：板块列表与成分均按日维护，查询时需指定或使用最新 `trade_date`。
2. **概念 vs 行业/地域**：概念板块有完整名称与领涨股（dc_index）；行业/地域板块当前仅从 dc_daily 取行情，名称以代码展示。
3. **仅限学习研究**：Tushare 注明本接口只限个人学习研究使用，商业用途需联系东方财富。

---

## 七、最佳实践建议

### 7.1 工具选择决策树

```
用户询问股票相关问题
│
├─ 询问单只股票的评分/分析？
│  └─ 使用 get_ai_predict
│
├─ 询问某一天的全部选股/评分情况？
│  └─ 使用 get_ai_predict_by_date
│
├─ 询问股票列表/选股结果？
│  └─ 使用 get_pipeline_results
│
├─ 询问股票基础信息？
│  └─ 使用 get_stock_basic 或 search_stocks
│
├─ 询问技术指标/K线数据？
│  └─ 使用 get_stock_technical 或 get_stock_kline
│
├─ 询问东财概念/行业/地域板块列表？
│  └─ 使用 get_dc_indices
│
├─ 询问某东财板块的成分股？
│  └─ 使用 get_dc_members
│
└─ 询问资金流向/大单数据？
   └─ 使用 get_ddx_ddy 或 get_stock_money_flow
```

### 7.2 组合使用建议

1. **全面分析单只股票**：
   - `get_stock_basic` → 基础信息
   - `get_ai_predict` → AI 评分和详细分析
   - `get_stock_technical` → 技术指标
   - `get_stock_money_flow` → 资金流向
   - `get_kpl_concepts` → 题材概念

2. **从选股结果中挑选优质标的**（**推荐流程**）：
   - `get_pipeline_results(stage="ddy_filtered")` → 获取最终筛选结果
   - 对感兴趣的股票调用 `get_ai_predict` → 获取详细评分
   - 按评分排序，关注 S≥85 的股票

3. **分析某一天的整体选股情况**：
   - `get_ai_predict_by_date(trade_date="YYYY-MM-DD")` → 该日全部 AI 预测结果（按排名）
   - 可统计高分股数量、分数分布或导出当日名单

4. **分析市场整体情况**：
   - `get_index_daily` → 大盘指数走势
   - `get_pipeline_results` → 各阶段选股数量（判断市场热度）

5. **行业/题材分析**：
   - `get_dc_indices` → 东财概念/行业/地域板块列表（涨跌幅、领涨股等）
   - `get_dc_members` → 某板块成分股

### 7.3 注意事项

1. **使用顺序**：**先调用 Pipeline 选股，再调用 AI 预测评分**。Pipeline 选股提供候选股票池，AI 预测评分提供买入决策依据
2. **日期一致性**：确保使用相同的 `trade_date` 参数，避免数据不一致
3. **评分阈值**：严格按照 S≥85（具备交易价值）、65≤S≤74（观望）、S<64（不具备交易价值）的阈值给出建议
4. **短线交易**：AI 预测评分适用于短线交易（1-5 个交易日），不适合长期投资
5. **数据时效性**：股票数据每日更新，建议使用最新日期的数据

---

## 八、常见问题

### Q1: AI 预测评分和 Pipeline 选股结果有什么区别？

**A**:

- **Pipeline 选股**：通过量化规则筛选出符合技术形态的股票池，返回股票列表
- **AI 预测评分**：对单只股票进行详细的技术形态分析，给出 0-100 的评分和详细原因

### Q2: 为什么 Pipeline 选出的股票，AI 评分可能不高？

**A**:

- Pipeline 选股是基于量化规则的初步筛选，确保股票符合基本技术形态
- AI 预测评分是更严格的综合评分，会考虑更多细节（如吸筹、震仓、出货等）
- 两者可以互补：Pipeline 提供候选池，AI 评分提供买入决策依据

### Q3: 如何判断一只股票是否值得买入？

**A**:

1. **推荐流程**：先通过 `get_pipeline_results(stage="ddy_filtered")` 获取选股结果，再对感兴趣的股票调用 `get_ai_predict` 获取评分
2. 如果 S≥85，技术形态上具备交易价值
3. 如果 65≤S≤74，建议观望
4. 如果 S<64，技术形态上不具备交易价值，或者交易风险较高
5. 可以结合 `get_stock_technical`、`get_stock_money_flow` 等工具获取更多技术细节

### Q4: Pipeline 的各个阶段有什么区别？

**A**:

- 越往后的阶段，筛选条件越严格，股票数量越少
- `ddy_filtered` 是最终筛选阶段，股票质量最高
- 建议优先关注 `ddy_filtered` 阶段的股票

### Q5: 如何查看某只股票是否在 Pipeline 选股结果中？

**A**:

1. 调用 `get_pipeline_results` 获取某个阶段的股票列表
2. 检查返回的列表中是否包含该股票代码
3. 可以查看多个阶段，了解该股票在哪个阶段被筛选掉

---

## 九、总结

本 MCP 服务提供了完整的A股主板股票技术分析和选股能力：

- **`get_pipeline_results`**：基于具体某个交易日所有A股主板股票收盘价，多阶段量化选股入池，提供候选股票池
- **`get_ai_predict`**：基于 Pipeline 选股漏斗的最终结果，给出单只股票的次日选股建议与详细分析
- **`get_ai_predict_by_date`**：获取某一天的全部 AI 预测结果（无需指定股票代码），便于分析当日整体选股情况
- **`get_dc_indices`** / **`get_dc_members`**：东财（东方财富）概念/行业/地域板块列表及板块成分股，数据来自 Tushare dc_index、dc_daily、dc_member

**推荐使用流程**：

1. **第一步**：调用 `get_pipeline_results(stage="ddy_filtered")` 获取最终筛选的股票列表
2. **第二步**：对列表中的股票调用 `get_ai_predict` 获取详细评分
3. **第三步**：根据评分阈值（S≥85 具备交易价值）做出买入决策

建议 OpenClaw 根据用户问题的类型，选择合适的工具或工具组合，提供准确、专业的股票分析服务。**优先使用 Pipeline 选股 + AI 预测评分的组合流程**。
